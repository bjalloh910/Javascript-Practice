<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="ticstyles.css">
    <title>TicTacToe</title>
</head>
<body>
    <div id="gameboard" class="gameboard"></div>
    <div id="output"></div>

    <script>
    // focus on the logic of the game 
    // store the gameboard as an array inside of a Gameboard object
    // players are also going to be stored in objects
    // another object to control the flow of the game
    // do this using function factories
    //TODO: think about the way the game works
    // 1. Create the Gameboard object
    const Gameboard = (function() {
        const board = [
            ['', '', ''],
            ['', '', ''],
            ['', '', '']
        ];
        return {
            getBoard(){
                return board;
            },
            updateBoard(row, col, marker){
                if (board[row][col] === ''){
                    board[row][col] = marker;
                    return true
                }
            },
            checkWinner(){
                let winnerFound = false;
                let message = '';
                // iterate through just the rows
                for (let i = 0; i < board.length; i++) {
                    if (board[i][0] !== '' && board[i][0] === board[i][1] && board[i][1] === board[i][2]) {
                        //console.log(`Winner found with marker: ${board[i][0]}`);
                        message = `Winner found with marker: ${board[i][0]}`;
                        document.getElementById("output").innerHTML = message;
                        winnerFound = true;
                        break;
                    }
                }
                // iterate though just the columns 
                for (let i = 0; i<board.length; i++) {
                    if(board[0][i] != '' && board[0][i] === board[1][i] && board[1][i] == board[2][i]){
                        message = `Winner found with marker: ${board[0][i]}`;
                        document.getElementById("output").innerHTML = message;
                        winnerFound = true;
                        break;
                    }
                }
                // iterate the diagonal
                if(board[0][0] != '' && board[0][0] === board[1][1] && board[1][1] === board[2][2]){
                    message = `Winner found with marker: ${board[i][i]}`;
                    document.getElementById("output").innerHTML = message;
                    winnerFound = true;
                }
            
                // iterate the opposite diagonal
                if(board[0][2] != '' && board[1][1] === board[0][2] && board[1][1] === board[2][0]){
                    message = `Winner found with marker: ${board[0][2]}`;
                    document.getElementById("output").innerHTML = message;
                    winnerFound = true;
                } 
                // If no winner is found, log "Game Over"
                if (!winnerFound){
                    message = "Game Over! No Winners.";
                }
            }
        }
    })(); // Note the () at the end to immediately invoke the function

    function player(name, marker) {
        return {
            getName() {
                return name
            },
            getMarker(){
                return marker
            }
        }
    }

    function gameFlow(player1, player2, gameBoard) {
        return function makeMove(player, marker){
            if (gameBoard.updateBoard(row, col, player.getMarker())) {
                console.log(`${player.getName()} placed ${player.getMarker()} at (${row}, ${col})`)
            } else {
                console.log("Invalid try again")
            }
        }
    }
    // create some player objects 
    const player1 = player("Alice", "X")
    const player2 = player("Bob", "0")
    console.log(player1.getName())
    console.log(player1.getMarker())
    console.log(player2.getName())
    console.log(player2.getMarker())
    console.log(Gameboard.getBoard());

    /*
    Ex:
        0      1   2
    0   [0:0, 0:1, 0:2],
    1   [1:0, 1:1, 1:2],
    2   [2:0, 2:1, 2:2]
    */
    
    const gameboard = [
        ['', '', ''],
        ['', '', ''],
        ['', '', '']
    ];
    
    const DisplayController = (function () {
    const gameboardContainer = document.getElementById('gameboard');
    let currentPlayer = null; // To keep track of the current player
    let player1 = null;
    let player2 = null;

    // Render the gameboard array to the DOM
    const renderGameboard = function (board) {
        //console.log("Rendering gameboard:", board);
        gameboardContainer.innerHTML = ''; // Clear the board

        board.forEach((row, rowIndex) => {
            row.forEach((cell, colIndex) => {
                const cellDiv = document.createElement('div');
                cellDiv.classList.add('cell');
                cellDiv.textContent = cell || ''; // Display X, O, or empty
                cellDiv.dataset.row = rowIndex;
                cellDiv.dataset.col = colIndex;

                // Add click event listener for each cell
                cellDiv.addEventListener('click', () => {
                    handleCellClick(rowIndex, colIndex);
                });

                gameboardContainer.appendChild(cellDiv);
            });
        });
    };

    // Handle cell click
    const handleCellClick = function (row, col) {
        if (Gameboard.getBoard()[row][col] !== '') {
            alert('Cell already taken! Choose another.');
            return;
        }

        // Update the gameboard with the current player's marker
        const marker = currentPlayer.getMarker();
        Gameboard.updateBoard(row, col, marker);

        // Check for a winner
        Gameboard.checkWinner();

        // Switch players
        currentPlayer = currentPlayer === player1 ? player2 : player1;

        // Re-render the gameboard
        renderGameboard(Gameboard.getBoard());
    };

    // Initialize the game
    const startGame = function (p1, p2) {
        player1 = p1;
        player2 = p2;
        currentPlayer = player1; // Start with player 1
        renderGameboard(Gameboard.getBoard());
    };

    return { startGame };
})();

    DisplayController.startGame(player1, player2);
            
    </script>

</body>
</html>
